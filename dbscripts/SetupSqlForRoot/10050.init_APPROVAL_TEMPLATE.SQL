SET DEFINE OFF;

--// BEG: #1, Customer Default Approval Template
INSERT INTO CNT_DATA_LIST_TYPE 
	(ID, REVISION, ENTITY_VERSION, DOMAIN_ID, VERSION, CREATE_USER,UPDATE_USER,CREATED_ON, UPDATED_ON, NAME,APPLY_TO_ENTITY, IS_LATEST,
	REF_NO
	)
	SELECT LOWER(SYS_GUID()), 1, 1, '/', 1, 'system','system',sysdate,sysdate,'APPROVAL_REJECT_REASON',2, 1,
	('S13'|| '-'|| LPAD(TO_CHAR(NVL((SELECT NEXT_VAL FROM CNT_SEQ_DEF WHERE DOMAIN_ID ='/' AND SEQ_ID ='CBX_SEQ_DATA_LIST_TYPE_REF_NO'), 0)), 6, '0'))
	FROM DUAL 
	WHERE NOT EXISTS (SELECT 1 FROM CNT_DATA_LIST_TYPE WHERE DOMAIN_ID = '/' AND NAME = 'APPROVAL_REJECT_REASON' AND APPLY_TO_ENTITY = 2);

UPDATE CNT_SEQ_DEF SET NEXT_VAL = NEXT_VAL + 1 WHERE DOMAIN_ID ='/' AND SEQ_ID ='CBX_SEQ_DATA_LIST_TYPE_REF_NO';

INSERT INTO CNT_APRV_TEMPL(
		ID, REVISION, ENTITY_VERSION, DOMAIN_ID, STATUS, 
		DOC_STATUS, EDITING_STATUS, CREATE_USER, UPDATE_USER, CREATED_ON, 
		UPDATED_ON, APRV_TYPE_ID, NAME, DESCRIPTION, APPLY_MODULE, 
		REJECT_RETURN_TO, REJECT_RETURN_STAGE_SEQ, NOTIFY_STAGE_AVAILABLE, NOTIFY_STAGE_APPROVED, NOTIFY_STAGE_REJECTED, 
		NOTIFY_PROFILE_APPROVED, NOTIFY_PROFILE_REJECTED, IS_LATEST, HUB_DOMAIN_ID, IS_FOR_REFERENCE,
		REF_NO
	) 
	SELECT 
		LOWER(LOWER(SYS_GUID())), 1, 1, '/', 'active', 
		'active', 'confirmed', 'system', 'system', SYSTIMESTAMP, 
		SYSTIMESTAMP, CDLT.ID, 'Customer Default Approval Template', 'Customer Default Approval Template', 
		'cust', 1, NULL, 1, 0, 0, 
		1, 1, 1, '/', 0,
		'TMPL12-000001'
	FROM CNT_DATA_LIST_TYPE CDLT WHERE CDLT.NAME = 'APPROVAL_REJECT_REASON' AND CDLT.DOMAIN_ID = '/';
	
INSERT INTO CNT_APRV_TEMPL_STAGE(ID, REVISION, ENTITY_VERSION, DOMAIN_ID, PARENT_ID, SEQ, NAME, MANDATORY, MIN_APPROVED, REJECT_REASON_CODE, DISABLED) SELECT LOWER(SYS_GUID()), 1, 1, TEMPL.DOMAIN_ID, TEMPL.ID, 1, 'Administrators Review', 1, 0, 'APPROVAL_REJECT_REASON', 0 FROM CNT_APRV_TEMPL TEMPL WHERE TEMPL.APPLY_MODULE = 'cust' AND TEMPL.NAME = 'Customer Default Approval Template' AND TEMPL.DOMAIN_ID = '/';
INSERT INTO CNT_APRV_TEMPL_STAGE(ID, REVISION, ENTITY_VERSION, DOMAIN_ID, PARENT_ID, SEQ, NAME, MANDATORY, MIN_APPROVED, REJECT_REASON_CODE, DISABLED) SELECT LOWER(SYS_GUID()), 1, 1, TEMPL.DOMAIN_ID, TEMPL.ID, 2, 'Administrators Review', 1, 0, 'APPROVAL_REJECT_REASON', 0 FROM CNT_APRV_TEMPL TEMPL WHERE TEMPL.APPLY_MODULE = 'cust' AND TEMPL.NAME = 'Customer Default Approval Template' AND TEMPL.DOMAIN_ID = '/';
INSERT INTO CNT_SELECTION(ID, REVISION, ENTITY_VERSION, DOMAIN_ID, STATUS, DOC_STATUS, EDITING_STATUS, CREATE_USER, UPDATE_USER, CREATED_ON, UPDATED_ON, PARENT_ID, PARENT_ENTITY, FIELD_ID, REF_ENTITY, REF_ID, DISPLAY_VALUE) SELECT LOWER(SYS_GUID()), 1, 1, STAGE.DOMAIN_ID, 'active', 'active', 'confirmed', 'system', 'system', SYSTIMESTAMP, SYSTIMESTAMP, STAGE.ID, 'AprvTemplStage', 'assigneeGroups', 'Group', CG.ID, NULL FROM CNT_APRV_TEMPL_STAGE STAGE, CNT_GROUP CG WHERE STAGE.NAME = 'Administrators Review' AND STAGE.DOMAIN_ID = '/' AND CG.DOMAIN_ID = STAGE.DOMAIN_ID AND CG.NAME  = 'ADMINISTRATORS';
INSERT INTO CNT_CONDITION(ID, REVISION, ENTITY_VERSION, CREATE_USER, UPDATE_USER, CREATED_ON, UPDATED_ON, DOMAIN_ID, NAME, EXPRESSION, CUSTOMIZE_CLASS, DESCN, IS_SYS, IS_LATEST) SELECT LOWER(SYS_GUID()), 1, 1, 'system', 'system', SYSTIMESTAMP, SYSTIMESTAMP, '/', 'remarksApproval', 'entity.remarks = ''Approval''', NULL, NULL, NULL, 1 FROM DUAL WHERE NOT EXISTS(SELECT 1 FROM CNT_CONDITION WHERE DOMAIN_ID = '/' AND NAME = 'remarksApproval' AND IS_LATEST = 1);
INSERT INTO CNT_APRV_TEMPL_MATCH_RULE(ID, REVISION, ENTITY_VERSION, DOMAIN_ID, PARENT_ID, PRIORITY, CONDITION_ID) SELECT LOWER(SYS_GUID()), 1, 1, TEMPL.DOMAIN_ID, TEMPL.ID, NULL, CON.ID FROM CNT_APRV_TEMPL TEMPL, CNT_CONDITION CON WHERE TEMPL.APPLY_MODULE = 'cust' AND TEMPL.NAME = 'Customer Default Approval Template' AND TEMPL.DOMAIN_ID = '/' AND CON.DOMAIN_ID = '/' AND CON.NAME = 'remarksApproval' AND CON.IS_LATEST = 1;

--// END: #1, Customer Default Approval Template

--//BEG: CNT-9463 (S60)
-----------------------------aprv template----------------------------------------------------------------
DECLARE
MAX_VAL VARCHAR2(20);
I_DOMAIN_ID VARCHAR2(20) :='/';
   CURSOR CSELECT
   IS
      SELECT ID, CREATED_ON, REF_NO FROM CNT_APRV_TEMPL
      WHERE (REF_NO NOT LIKE 'TMPL__-0%' OR REF_NO IS NULL)
      AND IS_LATEST ='1' AND DOMAIN_ID ='/';            
BEGIN
FOR SELECT_RECORD IN CSELECT
LOOP 
    IF TO_CHAR(SELECT_RECORD.CREATED_ON,'YY') = TO_CHAR(SYSDATE,'YY') THEN
      UPDATE CNT_APRV_TEMPL SET REF_NO = 'TMPL'|| TO_CHAR(CREATED_ON,'YY') || '-'|| LPAD(TO_CHAR(NVL((SELECT NEXT_VAL FROM CNT_SEQ_DEF WHERE DOMAIN_ID =I_DOMAIN_ID AND SEQ_ID ='CBX_SEQ_APRV_TEMPL_REF_NO'),0)),6,'0')  
      WHERE ID = SELECT_RECORD.ID;
      UPDATE CNT_SEQ_DEF SET NEXT_VAL = NEXT_VAL +1 WHERE SEQ_ID= 'CBX_SEQ_APRV_TEMPL_REF_NO' AND DOMAIN_ID = I_DOMAIN_ID;
    ELSE
    SELECT  NVL(MAX(TO_NUMBER( SUBSTR (REF_NO,8,6))),0) INTO MAX_VAL
    FROM CNT_APRV_TEMPL WHERE REF_NO LIKE 'TMPL__-0%' AND DOMAIN_ID =I_DOMAIN_ID AND IS_LATEST=1 AND TO_CHAR(CREATED_ON,'YY')=TO_CHAR(SELECT_RECORD.CREATED_ON,'YY');
    UPDATE CNT_APRV_TEMPL SET REF_NO = 'TMPL' || TO_CHAR (CREATED_ON,'YY') || '-'
      || LPAD(TO_CHAR(MAX_VAL+1),6,'0')  
       WHERE ID = SELECT_RECORD.ID;
    END IF;
END LOOP;
    END;
/
---------------------------------data list type---------------------------------------------------------
DECLARE
MAX_VAL VARCHAR2(20);
I_DOMAIN_ID VARCHAR2(20) :='/';
   CURSOR CSELECT
   IS
      SELECT ID, CREATED_ON, REF_NO FROM CNT_DATA_LIST_TYPE
      WHERE (REF_NO NOT LIKE 'S__-0%' OR REF_NO IS NULL)
      AND IS_LATEST ='1' AND DOMAIN_ID ='/';            
BEGIN
FOR SELECT_RECORD IN CSELECT
LOOP 
    IF TO_CHAR(SELECT_RECORD.CREATED_ON,'YY') = TO_CHAR(SYSDATE,'YY') THEN
      UPDATE CNT_DATA_LIST_TYPE SET REF_NO = 'S'|| TO_CHAR(CREATED_ON,'YY') || '-'|| LPAD(TO_CHAR(NVL((SELECT NEXT_VAL FROM CNT_SEQ_DEF WHERE DOMAIN_ID =I_DOMAIN_ID AND SEQ_ID ='CBX_SEQ_DATA_LIST_TYPE_REF_NO'),0)),6,'0')  
      WHERE ID = SELECT_RECORD.ID;
      UPDATE CNT_SEQ_DEF SET NEXT_VAL = NEXT_VAL +1 WHERE SEQ_ID= 'CBX_SEQ_DATA_LIST_TYPE_REF_NO' AND DOMAIN_ID = I_DOMAIN_ID;
    ELSE
    SELECT  NVL(MAX(TO_NUMBER( SUBSTR (REF_NO,5,6))),0) INTO MAX_VAL
    FROM CNT_DATA_LIST_TYPE WHERE REF_NO LIKE 'S__-0%' AND DOMAIN_ID =I_DOMAIN_ID AND IS_LATEST=1 AND TO_CHAR(CREATED_ON,'YY')=TO_CHAR(SELECT_RECORD.CREATED_ON,'YY');
    UPDATE CNT_DATA_LIST_TYPE SET REF_NO = 'S' || TO_CHAR (CREATED_ON,'YY') || '-'
      || LPAD(TO_CHAR(MAX_VAL+1),6,'0')  
       WHERE ID = SELECT_RECORD.ID;
    END IF;
END LOOP;
    END;
/
-------------------------------------condition-----------------------------------------------------
DECLARE
MAX_VAL VARCHAR2(20);
I_DOMAIN_ID VARCHAR2(20) :='/';
   CURSOR CSELECT
   IS
      SELECT ID, CREATED_ON, REF_NO FROM CNT_CONDITION
      WHERE (REF_NO NOT LIKE 'S__-0%' OR REF_NO IS NULL)
      AND IS_LATEST ='1' AND DOMAIN_ID ='/';            
BEGIN
FOR SELECT_RECORD IN CSELECT
LOOP 
    IF TO_CHAR(SELECT_RECORD.CREATED_ON,'YY') = TO_CHAR(SYSDATE,'YY') THEN
      UPDATE CNT_CONDITION SET REF_NO = 'S'|| TO_CHAR(CREATED_ON,'YY') || '-'|| LPAD(TO_CHAR(NVL((SELECT NEXT_VAL FROM CNT_SEQ_DEF WHERE DOMAIN_ID =I_DOMAIN_ID AND SEQ_ID ='CBX_SEQ_CONDITION_REF_NO'),0)),6,'0')  
      WHERE ID = SELECT_RECORD.ID;
      UPDATE CNT_SEQ_DEF SET NEXT_VAL = NEXT_VAL +1 WHERE SEQ_ID= 'CBX_SEQ_CONDITION_REF_NO' AND DOMAIN_ID = I_DOMAIN_ID;
    ELSE
    SELECT  NVL(MAX(TO_NUMBER( SUBSTR (REF_NO,5,6))),0) INTO MAX_VAL
    FROM CNT_CONDITION WHERE REF_NO LIKE 'S__-0%' AND DOMAIN_ID =I_DOMAIN_ID AND IS_LATEST=1 AND TO_CHAR(CREATED_ON,'YY')=TO_CHAR(SELECT_RECORD.CREATED_ON,'YY');
    UPDATE CNT_CONDITION SET REF_NO = 'S' || TO_CHAR (CREATED_ON,'YY') || '-'
      || LPAD(TO_CHAR(MAX_VAL+1),6,'0')  
       WHERE ID = SELECT_RECORD.ID;
    END IF;
END LOOP;
    END;
/
--//BEG: CNT-9463 (S60)